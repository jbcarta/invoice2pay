<!-- *****************************************

        Supplierinvoice_new_detail.hbs

***************************************** -->  

<!--
<div w3-include-html="supplierinvoice_detail_menu.hbs"></div>
-->
<!--
<script type="text/hbs" src="supplierinvoice_detail_menu.hbs"></script>
==>

<!-- *****************************************

        Supplierinvoice_new_detail_menu.hbs

***************************************** -->  

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container  container-fluid head-tit">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" 
                 data-target="#bs-example-navbar-collapse-2" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <h1 name="titulo" id="titulo">
               {{ title }}
          </h1>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
          <ul class="nav navbar-nav">
            <li class="active">       <span class="sr-only">(current)</span></a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menu<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a onclick="grabar()" name="grabar" id="grabar">Grabar</a></li>
<!--                <li><a href="/supplierInvoiceInsert">Grabar Nueva Factura</a></li>                
-->

                <li><a href="/supplierInvoice_Pending">Salir sin Grabar</a></li>
                <li role="separator" class="divider"></li>

                <li><a href="/">Regresar al Menu Principal12</a></li>
              </ul>
            </li>
          </ul>
        </div>
    </div>
</nav>



<div class="row">





<!-- variables globales -->
  <input id="currentRow"  name="currentRow" type="hidden" />


<!--
    <form action="/supplierinvoice_edit/{{ this._id }}" method="post" id="checkout-form" class="form-horizontal">

    <form action="" method="post" id="supplierInvoice_new" name="supplierInvoice_new" class="form-horizontal">
-->



    <form action="/supplierInvoiceInsert/{{ this.tdetail }}" method="post" 
          id="supplierInvoice_new" name="supplierInvoice_new" onsubmit="return formValidation()" 
          class="form-horizontal" , enctype='application/x-www-form-urlencoded'> 

      <input name="aplevel" id="aplevel" type="hidden"/>
      <input name="approver1" id="approver1" type="hidden"/>                
      <input name="approver2" id="approver2" type="hidden"/>
      <input name="approver3" id="approver3" type="hidden"/>
      <input name="approver4" id="approver4" type="hidden"/>
      <input name="approver5" id="approver5" type="hidden"/>             
      <input name="crud_type" id="crud_type" type="hidden"/>             

      <!--
          <button name="test_function" id="test_function" onclick="exist_invoice()"> Test Función</button>
      -->

    <div class="container">
        <div class="row">


<!--            <input type='hidden' name="id" id="id" value="{{this._id}}" /> 
-->


            <!-- First Column -->         
            <div class="col-lg-4 col-md-4 col-sm-12">

                <!-- Proveedor -->
                <div class="form-group">
                   <label for="supplier" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Proveedor :</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group date' id='datetimepicker1'>
                            <input type='text' class="form-control separate-bottom" readonly="readonly" placeholder="indique el proveedor" name="supplier" id="supplier" value="{{supplier}}"/> <span class="input-group-addon">
                            <a href="#" data-toggle="modal" data-target=".modal-provee"><span class="fa fa-external-link"></a></span>
                        </div>
                   </div>                                               
                </div>

                 <!-- Company -->
                <div class="form-group">
                   <label for="doctype" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Compañia:</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group date' id='datetimepicker1'>
                            <select class="form-control selectpicker show-tick" name="company"
                                     id="company" required>
                               <!-- <option selected>{{company}}</option> -->
                                <option selected>000:Indique Compañia</option>
                                <option>XA01:CLAXSON ARGENTINA</option>
                                <option>XA02:LIFESTYLE TV SRL</option>
                                <option>XA03:NAVAJO ENTERTAINMENT</option>
                                <option>XSDC:MIXPLAY S.A.</option>
                                <option>XU01:CLAXSON USA II, INC.</option>
                                <option>XU06:PLAYBOY TV LA</option>
                                <option>XU12:PLAYBOY TV BV</option>
                                <option>XU40:DLA, INC.</option>
                                <option>XU42:PLAYBOY LIFESTYLES H</option>
                                <option>XVE1:CONTRIBUTION S.R.L.</option>
                                <option>XVE2:VENUS TV, INC</option>
                            </select>
                        </div>
                   </div>                                               
                </div>                                           

                <!-- Tipo de Doc -->
                <div class="form-group">
                   <label for="doctype" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Tipo de Doc :</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>
                        <!--                            
                            <input type='text' class="form-control separate-bottom" readonly="readonly" placeholder="indique tipo de documento" name="supplier" id="supplier" value="{{this.doctype}}"/> 
                        -->
                            <select class="form-control selectpicker show-tick" name="tpdoc"
                                     id="tpdoc" required>

                                <!--
                                <option value="{{documenttype}}" selected>{{documenttype}}</option>              
                                -->
                                <option> 00:Indique tipo Doc</option>
                                <!--
                                <option>KA:DOC.DE ACREEDOR</option>
                                <option>KB:DOC.DE ACREEDOR</option>
                                <option>KC:COMPENSACION ACREED</option>
                                -->
                                <option>KD:NOTA DEB.ACREEDOR</option>
                                <!--
                                <option>KE:FACTURA ACREEDOR SL</option>
                                <option>KF:FACTURA ACREEDOR</option>
                                -->
                                <option>KG:NOTA CRED.ACREEDOR</option>
                                <option>KL:FACTURA ACREEDOR SL</option>
                                <!--
                                <option>KM:NOTA DEB.ACREEDOR SL</option>
                                <option>KN:ACREEDORES NETO</option>
                                <option>KO:NOTA CRED.ACREED.SL</option>
                                <option>KP:ACTUALIZ.CUENTAS</option>
                                -->
                                <option>KR:FACTURA ACREEDOR</option>
                                <!--
                                <option>KT:FACT.SERV.PUBLICOS</option>
                                <option>KU:N.CRED.SERV.PUBLICOS</option>
                                -->
                            
                            </select>
                        </div>
                   </div>                                               
                </div>


                <!-- Numero de Documento -->
                <div class="form-group">
                   <label for="doctype" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Num Doc :</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>

                            <input type='text' class="form-control separate-bottom" placeholder="Número del documento" name="numdoc" id="numdoc" value="{{documentnumber}}"/> 
                        </div>
                   </div>                                               
                </div>  

                <!-- Currency -->
                <div class="form-group">
                   <label for="currency" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Moneda :</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group date' id='datetimepicker1'>
                            <select class="form-control selectpicker show-tick" name="currency"
                                     id="currency" required>
                            <!--    <option selected>{{currency}}</option>
                            -->
                                <option>000:Indique Moneda</option>
                                <option>ARS</option>
                                <option>BRL</option>
                                <option>CLP</option>
                                <option>COP</option>
                                <option>EUR</option>
                                <option>MXN</option>
                                <option>USD</option>
                                <option>VEB</option>
                                <option>VEL</option>
                            </select>
                        </div>
                   </div>                                               
                </div>


                <!-- Tasa de Cambio -->
                <div class="form-group">
                   <label for="exchangerate" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Tasa de Cambio :</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>

                            <input type='text' class="form-control separate-bottom" placeholder="Tasa de Cambio" name="exchangerate" id="exchangerate" value="{{exchangerate}}"/> 
                        </div>
                   </div>                                               
                </div>  

 
            </div>
            
            <!-- Second Column --> 
            <div class="col-lg-4 col-md-4 col-sm-12">

                <!-- Fecha Contable -->
                <div class="form-group">
                   <label for="accountingdate"  
                        class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Fecha Contable: </label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>
                            <input  type='date' class="form-control separate-bottom" 
                                    name="accountingdate" id="accountingdate" value="{{accountingdate}}"/>
                        </div>
                    </div>
                </div>

                <!-- Fecha Documento -->
                <div class="form-group">
                   <label for="documentdate" 
                          class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Fecha Doc: </label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>
                            <input  type='date' class="form-control separate-bottom" 
                                    name="documentdate" id="documentdate" value="{{documentdate}}"/>
                        </div>
                    </div>
                </div>
                

                <!-- Monto neto de Factura -->
                <div class="form-group">
                   <label for="doctype" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Neto:</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>
                            <input  type='text' class="form-control separate-bottom" placeholder="Monto Neto" 
                                    name="amountinvoice" id="amountinvoice" value="{{netamountinvoice}}"/> 
                        </div>
                   </div>                                               
                </div>                

                <!-- Monto de Impuestos -->
                <div class="form-group">
                   <label for="doctype" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Impuestos :</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>
                            <input type='text' class="form-control separate-bottom" placeholder="Indique impuestos" name="totaltax" id="totaltax" value="{{totaltax}}"/> 
                        </div>
                   </div>                                               
                </div>                


                <!-- Monto total de Factura -->
                <div class="form-group">
                   <label for="doctype" 
                         class="control-label col-lg-4 col-md-4 col-sm-12 col-xs-12">Total:</label>
                   <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <div class='input-group'>
                            <input type='text' class="form-control separate-bottom" placeholder="Monto Total" name="totalinvoice" id="totalinvoice" value="{{totalinvoice}}" readonly="readonly" /> 
                        </div>
                   </div>                                               
                </div>                
           </div>
            
             <!-- Third Column -->           
            <div class="col-lg-4 col-md-4 col-sm-12">

              <div class="panel panel-default panel-table">
                  <div class="panel-heading">
                    <div class="row">
                      <div class="col col-xs-6">
                        <h3 class="panel-title">Impuestos</h3>
                      </div>
                      <div class="col col-xs-6 text-right">
                        <button type="button" class="btn btn-sm btn-primary btn-create" onclick="addtax()">Nuevo Impuesto</button>
                      </div>
                    </div>
                  </div>
                  <div class="panel-body">
                    <table  id="ttax" name="ttax" 
                            class="table table-striped table-bordered table-list">
                      <thead>
                        <tr>
                            <th><em class="fa fa-cog"></em></th>
                            <!--
                                <th class="hidden-xs">ID</th>
                            -->
                            <th>Cod.Imp.</th>
                            <th>Monto</th>
                        </tr> 
                      </thead>
                      <tbody>
                        {{# each detailtax }}                      
                              <tr>
                                <td align="center">
                                  <!--
                                    <a class="btn btn-default"><em class="fa fa-pencil"></em></a>
                                  -->

                                  <a class="btn btn-danger" onclick="deletetax()"><em class="fa fa-trash"></em></a>
                                </td>
                                <!--
                                <td class="hidden-xs">1</td>
                                -->
                                <td> 
                                  <select class="form-control selectpicker show-tick" 
                                          name="taxcode"
                                          id="taxcode" required>
                                      <option selected>{{this.taxcode}}</option>
                                      <option>00:Cod</option>
                                      <option>C1:IVA 21%</option>     
                                      <option>CX:Sin Impuestos</option>
                                      <option>S1:IVA 27%</option>
                                      <option>T1:IVA 10,5%</option>
                                      <option>XC:Perc. IVA 1,5%</option>
                                      <option>XD:Perc. IVA 3,00%</option>
                                      <option>X3:Perc. IIBB 5%</option>
                                      <option>X2:Perc. IIBB a n/favor CABA</option>
                                      <option>X6:Perc. IIBB a n/favor CABA</option>
                                      <option>X0:Perc. IIBB a n/favor CABA</option>
                                      <option>XH:Perc. IIBB a n/favor Pcia. BsAs</option>
                                      <option>XB:Perc. IIBB a n/favor Pcia. BsAs</option>
                                      <option>X5:Perc. IIBB a n/favor Santa Fe</option>
                                      <option>XG:Perc. IIBB a n/favor Tucumán</option>
                                      <option>X9:Perc. IIBB a n/favor Tucumán</option>
                                      <option>XE:Perc. IIBB a n/favor San Luis</option>
                                      <option>XF:Perc. IIBB a n/favor Misiones</option>
                                      <option>XI:Perc. IIBB a n/favor San Juan</option>
                                      <option>XJ:Perc. IIBB a n/favor Salta</option>
                                      <option>XK:Perc. IIBB a n/favor Catamarca</option>
                                      <option>XL:Perc. IIBB a n/favor Mendoza</option>
                                      <option>XM:Perc. IIBB a n/favor Jujuy</option>
                                      <option>XN:Perc. IIBB a n/favor CABA</option>
                                  </select>
                                </td>
                                <td>
                                  <input  type="text" class="form-control separate-bottom"  
                                          placeholder="Monto" name="taxamount" id="taxamount" value="{this.taxamount}}"/>
                                </td>
                              </tr>
                        {{/each}}                                 
                      </tbody>
                    </table>
                
                  </div>
                  <!--
                  <div class="panel-footer">
                    <div class="row">                 
                    </div>
                  </div>
                  -->
              </div>
            
            <!-- Fourth Column --> 
            <div class="col-lg-3 col-md-3 col-sm-12 butCont">
            </div>
            
        </div>
    </div>
            


    <!-- END OF HEADER -->


    <hr size="6" color="blue" width="60%"></hr>

    <div class="container">
        
        <table id="tdetail" name="tdetail" 
               class="table table-striped table-bordered" 
               cellspacing="0" width="90%" align="left" hover>
                    <thead>
                        <tr>
                            <th>Acción</th>
                            <th>Linea</th>                            
                            <th>CeCo</th>
                            <th>Cuenta</th>
                            <th>Orden</th>
                            <th>Concepto</th>
                            <th>Mes Serv</th>
                            <th>Descripción</th>
                            <th>Status</th>
<!--                            <th>Compañia</th>
-->
                        </tr>
                    </thead>

                   </tbody>

<!--                                        <a name="addRowSupplier" id="addRowSupplier"><i class="fa fa-file-o"></i> Nuevo</a>
-->
<!--
                    <button name="saveInvoice" 
                            id="savInvoice">
                            <i class="fa fa-floppy-o" aria-hidden="true"></i> Grabar</button>
                                    
-->
<!--
                   <input type="button" name="addLine" onclick="addline()"
                           id="addLine" class="btn btn-success" value="Agregar Linea"/>
-->                           
<!--
                            <i class="fa fa-file-o"></i>
-->                            
                    <button name="delRowCeco"
                            id="delRowCeco" 
                            class="btn btn-danger" 
                            style="visibility: hidden">
                    <i class="fa fa-file-o"></i> Eliminar Linea</button>

                    <button name="cancelDelRowCeco"
                            id="cancelDelRowCeco" 
                            class="btn btn-warning"
                            style="visibility: hidden">
                    <i class="fa fa-file-o"></i> Cancelar</button>


<!--
                                        <button name="saveRowSupplier" id="savstyle="visibility: hidden"eRowSupplier"  style="visibility: hidden"><i class="fa fa-floppy-o" aria-hidden="true"></i> Grabar</button>
-->                                     

        </table>  
    </div>
    </form>
</div>


<!--  ************************************************ -->

<!--  *********  M O D A L   W I N D O W S *********** -->

<!--  ************************************************ -->



<!--   

       Tabla Dinamica Proveedores

-->       
    <div    class="modal fade modal-provee" tabindex="-1" 
            id="modal-provee" name="modal-provee"
            data-target="#bs-example-modal-sm-provee"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Proveedores &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                    <table id="tsupplier" name="tsupply" class="table table-striped table-bordered" 
                           cellspacing="0" width="50%">
                    </table>      
                </div>
            </div>
        </div>
    </div>


<!--   
       Tabla Dinamica Cecos
-->       
    <div    class="modal fade modal-cecos" tabindex="-1" 
            id="modal-cecos"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button id="btn_mcecos" name="btn_mcecos" type="button" class="close" data-dismiss="modal" aria-hidden="true">Centro de Costos &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                    <table id="tusercecos" name="tusercecos" class="table table-striped table-bordered" 
                           cellspacing="0" width="50%">
                    </table>      

                </div>
                <div class="modal-footer">
                    <button id="btn_clearcecos" name="btn_clearcecos" type="button" 
                            class="close" data-dismiss="modal" aria-hidden="true">Limpiar Campo</button>
                        {{火}} {{huo}}
                </div>                                
            </div>
        </div>
    </div>


<!--   
       Tabla Dinamica Accounts
-->       
    <div    class="modal fade modal-accounts" tabindex="-1" 
            id="modal-accounts"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Cuentas &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                    <table id="tuseraccounts" name="tuseraccounts" class="table table-striped table-bordered" 
                           cellspacing="0" width="50%">
                    </table> 
                </div>
                <div class="modal-footer">
                    <button id="btn_clearaccount" name="btn_clearaccount" type="button" 
                            class="close" data-dismiss="modal" aria-hidden="true">Limpiar Campo</button>
                        {{火}} {{huo}}
                </div>
            </div>
        </div>
    </div>

<!--   
       Tabla Dinamica Order
-->       
    <div    class="modal fade modal-tfiorders" tabindex="-1" 
            id="modal-tfiorders"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ordenes &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                    <table id="tuserfiorders" name="tuserfiorders" class="table table-striped table-bordered" 
                           cellspacing="0" width="50%">
                    </table>      

                </div>
                <div class="modal-footer">
                    <button id="btn_clearorden" name="btn_clearorden" type="button" 
                            class="close" data-dismiss="modal" aria-hidden="true">Limpiar Campo</button>
                        {{火}} {{huo}}
                </div>                                                
            </div>
        </div>
    </div>



<!--   
       Concepts 
-->       
    <div    class="modal fade modal-concepts" tabindex="-1" 
            id="modal-concepts"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Conceptos &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                    <table id="tconcepts" name="tconcepts" class="table table-striped table-bordered" 
                           cellspacing="0" width="50%">
                    </table> 
                </div>
                <div class="modal-footer">
                    <button id="btn_clearconcept" name="btn_clearconcept" type="button" 
                            class="close" data-dismiss="modal" aria-hidden="true">Limpiar Campo</button>
                        {{火}} {{huo}}
                </div>                                    
            </div>
        </div>
    </div>


<!--   
       Tabla Dinamica ServiceMonth
-->       
    <div    class="modal fade modal-tservicemonth" tabindex="-1" 
            id="modal-tservicemonth"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Meses &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                    <table id="tservicemonth" name="tservicemonth" class="table table-striped table-bordered" 
                           cellspacing="0" width="50%">
                    </table>      

                </div>
            </div>
        </div>
    </div>


<!--   
       Description 
-->       
    <div    class="modal fade modal-description" tabindex="-1" 
            id="modal-descriptions"
            role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button id="btn_mdescription" name="btn_mdescription" type="button" class="close" data-dismiss="modal" aria-hidden="true">Description &times;</button>
                        {{火}} {{huo}}
                </div>
                <div class="modal-body">
                      <textarea rows="3" cols="50" class="form-control separate-bottom" placeholder="indique descripción" name="tdescription" id="tdescription"></textarea>
                </div>
                <div class="modal-footer">
                    <button id="btn_cleardescription" name="btn_cleardescription" type="button" 
                            class="close" data-dismiss="modal" aria-hidden="true">Limpiar Campo</button>
                        {{火}} {{huo}}
                </div>                 
            </div>
        </div>
    </div>



<!--  ************************************************ -->

<!--  *********     J A V A S C R I P T    *********** -->

<!--  ************************************************ -->

<script type="text/javascript">
     var currentRow = -1;
</script>

<script src="/js/casupolibs.js" type="text/javascript"> </script>


<script src="/js/tsuppliers.js" type="text/javascript"> </script>
<script src="/js/t_usercecos.js" type="text/javascript"> </script>
<script src="/js/tconcepts.js" type="text/javascript"> </script>
<script src="/js/t_useraccounts.js" type="text/javascript"> </script>
<script src="/js/t_userfiorders.js" type="text/javascript"> </script>
<script src="/js/tservicemonth.js" type="text/javascript"> </script>
<script src="/js/tcompany.js" type="text/javascript"> </script>


<script type="text/javascript">


    // ***********************************
    //         Document Ready
    // ***********************************

    $(document).ready(function () 
    {   

        var currentColumn = 0;

        var currentRow = [];

        // ------------------------------------
        //         Actitate table Supply
        // -----------------------------------
        var oDetail =  $('#tdetail').DataTable(
                  {
                      //"pagingType": "full",
                      "bPaginate": false,
                      "searching": false,
                      "bLengthChange": false,
                      "pageLength": 50,
                      dom: 'Bfrtip',
                      select: true,
                      "language": {
                                      "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                                  },            
                        "columnDefs": 
                      [
                          { targets: [0,1,2,3,4,5,6,7], visible: true},
                          { targets: [2,3,5,7], width: "20%"},
                          { targets: [6], width: "12%"},

                          { targets: [0], searchable: false},
                          { targets: '_all', width: null},

                          { targets: '_all', visible: false }            
                      ]
                  });


        // ------------------------------------
        //         Actitate table Supply
        // -----------------------------------
        var otax =  $('#ttax').DataTable(
        {
            //"pagingType": "full",
            "bPaginate": false,
            "searching": false,
            "bLengthChange": false,
            "pageLength": 50,
            dom: 'Bfrtip',
            select: false,
            "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/Spanish.json"
                        },            
              "columnDefs": 
            [
                { targets: [0,1,2], visible: true},
                //{ targets: [0,1], width: "20%"},
                { targets: [2], width: "60%"}
            ]     
        }); 

        addline();
        addtax();

    });

</script>



<script type="text/javascript">

        // ------------------------------------
        //         btn_clearcecos
        // -----------------------------------        
        $('#btn_clearcecos').on( 'click', function () 
        {

            // alert("btn_clearcecos");
            var table = $('#tdetail').DataTable();
            if (table.cell( $("#currentRow").val(), 3).data())
            {
                var tval =  '<input type="text" class="form-control separate-bottom" readonly="readonly" '+ 
                            'placeholder="indique el Cecos" name="costcenter" id="costcenter" '+
                            ' value=""/><span class="input-group-addon">'+
                            '<a href="#" data-toggle="modal" data-target=".modal-cecos">'+
                            '<span class="fa fa-external-link"></a></span>';
                //var xx = $("#currentRow").val();
                table.cell( $("#currentRow").val(), 2).data(tval);
            }
          });

        // ------------------------------------
        //         btn_clearaccount
        // -----------------------------------
        $('#btn_clearaccount').on( 'click', function () 
        {

            //alert("btn_clearcecos");
            var table = $('#tdetail').DataTable();
            if (table.cell( $("#currentRow").val(), 3).data())
            {
                var tval =  '<input type="text" class="form-control separate-bottom" readonly="readonly" '+ 
                            'placeholder="indique la Cuenta" name="accountcode" id="accountaccountcode" '+
                            ' value=""| "{{this.accountcode}}"/><span class="input-group-addon">'+
                            '<a href="#" data-toggle="modal" data-target=".modal-accounts">'+
                            '<span class="fa fa-external-link"></a></span>'

                table.cell( $("#currentRow").val(), 3).data(tval);
            }
        });


        // ------------------------------------
        //         btn_orden
        // -----------------------------------        
        $('#btn_clearorden').on( 'click', function () 
        {
            //alert("btn_clearorden");
            var table = $('#tdetail').DataTable();
            if (table.cell( $("#currentRow").val(), 3).data())
            {
                var table = $('#tdetail').DataTable();
                var tval =  '<input type="text" class="form-control separate-bottom" readonly="readonly" '+ 
                            'placeholder="indique la Orden" name="order" id="order" '+
                            ' value= ""'+'| "{{this.order}}"/><span class="input-group-addon">'+
                            '<a href="#" data-toggle="modal" data-target=".modal-tfiorders">'+
                            '<span class="fa fa-external-link"></a></span>'            
                table.cell( $("#currentRow").val(), 4).data(tval);
            }

        });

        // ------------------------------------
        //         btn_clearconcept
        // -----------------------------------
        $('#btn_clearconcept').on( 'click', function () 
        {

            //alert("btn_clearconcept");
            var table = $('#tdetail').DataTable();
            var tval =  '<input type="text" class="form-control separate-bottom"'+ 
                        ' readonly="readonly" placeholder="indique Concepto" name="concept"'+ 
                        'id="concept" value=""/>'+
                        '<span class="input-group-addon">'+
                        '<a href="#" data-toggle="modal" data-target=".modal-concepts">'+
                        '<span class="fa fa-external-link"></a></span>'
            table.cell( $("#currentRow").val(), 5).data(tval);

        });

        // ------------------------------------
        //         btn_cleardescription
        // -----------------------------------
        $('#btn_cleardescription').on( 'click', function () 
        {

            //alert("btn_clearcecos");
            var table = $('#tdetail').DataTable();
            var tval =  '<input type="text" class="form-control separate-bottom" readonly="readonly" '+ 
                        'placeholder="indique la description" name="description" id="description" '+
                        ' value=""/><span class="input-group-addon">'+
                        '<a href="#" data-toggle="modal" data-target=".modal-description">'+
                        '<span class="fa fa-external-link"></a></span>'            
            table.cell( $("#currentRow").val(), 7).data(tval);

        });






    // ------------------------------------
    //         addline()
    // -----------------------------------
    //    $('#addLine').on( 'click', function (e) 
    function addline()
    {

        //  e.preventDefault();
        //  alert('addLine1');
        var ts = $('#tdetail').DataTable();
        //  alert(ts.rows().data()[0]);

        if (ts.rows().data()[0])
        {
          alert("Solo se permite una linea")
        }
        else
        {
/*
              '<td><a class="delete" href=""><i class="fa fa-times" aria-hidden="true"></i></a></td>'+" "+
  

                   <input type="button" name="addLine" onclick="addline()"
                           id="addLine" class="btn btn-success">
*/
            currentRow = ts.row.add( 
            [
                /*'<td><input type="button" name="modifyline" onclick="modifyline()" value="Modif"></td>'+" "+
                '<td><input type="button" name="deleteLine" onclick="deleteline()" value="Elimin"></td>',
                */
                ' ',
                '<input type="text" class="form-control separate-bottom" readonly="readonly"  name="linenumber" id="linenumber" value="10"/>',
                '<input type="text" class="form-control separate-bottom" readonly="readonly" placeholder="indique el Cecos" name="costcenter" id="costcenter" value="{{this.costcenter}}"/> <span class="input-group-addon"><a href="#" data-toggle="modal" data-target=".modal-cecos"><span class="fa fa-external-link"></a></span>',
                '<input type="text" class="form-control separate-bottom" readonly="readonly" placeholder="indique la Cta Contable" name="accountcode" id="accountcode" value="{{this.accountcode}}"/> <span class="input-group-addon"><a href="#" data-toggle="modal" data-target=".modal-accounts"><span class="fa fa-external-link"></a></span>',
                '<input type="text" class="form-control separate-bottom" readonly="readonly" placeholder="indique nro orden" name="order" id="order" value="{{this.order}}"/> <span class="input-group-addon"> <a href="#" data-toggle="modal" data-target=".modal-tfiorders"><span class="fa fa-external-link"></a></span>',
                '<input type="text" class="form-control separate-bottom" readonly="readonly" placeholder="indique Concepto" name="concept" id="concept" value="{{this.concept}}"/><span class="input-group-addon"><a href="#" data-toggle="modal" data-target=".modal-concepts"><span class="fa fa-external-link"></a></span>',
                '<input type="month" class="form-control separate-bottom" placeholder="indique mes servicio" name="servicemonth" id="servicemonth" value="{{this.servicemonth}}"/>',
                '<input type="text" class="form-control separate-bottom" placeholder="indique description" name="description" id="description" readonly="readonly" value="{{this.description}}"/><span class="input-group-addon"><a href="#" data-toggle="modal" data-target=".modal-description"><span class="fa fa-external-link"></a></span>',
                'N'
            ] ).draw();

            // alert(currentRow);
        };
    };


    // ------------------------------------
    //         modifyline()
    // -----------------------------------
    function modifyline()
    {
      alert("Modify Line");
    };

    // ------------------------------------
    //         deleteline()
    // -----------------------------------
    function deleteline()
    {
      alert("Delete Line");
    };

    $('#tdetail tbody').on( 'click', 'td', function () 
    {

      // alert("Entro ");
      var currentColumn = $(this).parent().children().index($(this));
      var currentRow = $(this).parent().parent().children().index($(this).parent());
      $("#currentRow").val($(this).parent().parent().children().index($(this).parent()));

      //  $("#currentRow").val(this);

      //  alert('Row: ' + currentRow + ', Column: ' + currentColumn);          
      //  console.log('this:',this);
      //  console.log('this.row:',$(this).row().index());
      //  alert('this:',this);
      //  alert('this.row:',$(this).row().index());


      if ($(this).index()==7)
      {
          var ts = $('#tdetail').DataTable();
          var data = ts.cell( this ).data();
          // alert(' Entrando description data:'+data);

          var data1 = extraerInput(data);
          // alert('data1:'+data1);

          $("#tdescription").val(data1);
      }
    });



    $('#btn_mdescription').on( 'click', function () 
    {
      //alert('saliendo de description:'+$('#tdescription').val());

      var table = $('#tdetail').DataTable();
      var tval =  '<input type="text" class="form-control separate-bottom" readonly="readonly" '+ 
                  'placeholder="indique la description" name="description" id="description" '+
                  ' value='+$('#tdescription').val()+'| "{{this.costcenter}}"/><span class="input-group-addon">'+
                  '<a href="#" data-toggle="modal" data-target=".modal-description">'+
                  '<span class="fa fa-external-link"></a></span>'            
      table.cell( $("#currentRow").val(), 7).data(tval);
    });

    $('#btn_mdescriptionxxx').on( 'click', function () 
    {
      // alert('saliendo de description:'+$('#tdescription').val());

      var table = $('#tdetail').DataTable();
      var tval =  '<input type="text" class="form-control separate-bottom" readonly="readonly" '+ 
                  'placeholder="indique la description" name="description" id="description" '+
                  ' value='+$('#tdescription').val()+'| "{{this.costcenter}}"/><span class="input-group-addon">'+
                  '<a href="#" data-toggle="modal" data-target=".modal-description">'+
                  '<span class="fa fa-external-link"></a></span>'            
      table.cell( $("#currentRow").val(), 6).data(tval);
    });
//}
</script>


<script type="text/javascript">

//    $('#grabar').on( 'click', function (e) 

    // ------------------------------------
    //         grabar()
    // -----------------------------------
    function grabar()
    {
        //var svar = "variable enviada"

        if (formValidation())
        {

         var e_currency = $("#currency :selected").text(); ;
         //alert(e_currency);

         //alert('e_currency:'+e_currency);

         var t_amountinvoice = transform_2_number($("#amountinvoice").val());
         //var t_amountinvoice = transform_2_formatnumber(num1);
         var t_params = "amountinvoice="+t_amountinvoice+
                        "&currency="+$("#currency :selected").text()+
                        "&costcenter="+$("#costcenter").val()+'"'

          console.log('t_amountinvoice:',t_amountinvoice);               
          $.ajax(
          {
                url: "/api/exist_approvalschema?"+t_params,  
                success: function(returnval) 
                {
                   //                alert("testajax - return success:");

                   //alert("testajax - Data:"+returnval["error"]+"<>"+returnval["message"]);
                   //alert("testajax - Data-message:",data["message"]);


                    if (returnval["error"] == true) 
                    {
                        //alert("No puede grabar la factura. Requiere definir un Esquema de Aprobación");
                        alert(returnval["message"]);
                        
                    }
                    else
                    {
                      //alert("testajax - aplevel:"+returnval["aplevel"]);
                      $("#aplevel").val(returnval["aplevel"]);
                      $("#approver1").val(returnval["approver1"]);
                      $("#approver2").val(returnval["approver2"]);
                      $("#approver3").val(returnval["approver3"]);
                      $("#approver4").val(returnval["approver4"]);
                      $("#approver5").val(returnval["approver5"]);
                      //alert("Parametros recibidos:"+$("#aplevel").val()+"<>"+$("#approver1").val()+"<>"+
                      //                  $("#approver2").val()+"<>"+$("#approver3").val()+"<>"+
                      //                  $("#approver4").val()+"<>"+$("#approver5").val());

                      $('#supplierInvoice_new').submit();


                      //                      document.getElementById('returnaction').value = "Modificar"
                      //$('#supplierinvoicePostEdit').submit();
                    }

                },
                error: function(returnval) {
                            alert("Error - Requiere definir un Esquema de Aprobación");
                            //$(".message").text(returnval + " failure");
                            //$(".message").fadeIn("slow");
                            //$(".message").delay(2000).fadeOut(1000);
                        }
                //        ,
                //complete : function(xhr, status) {
                //        alert('Petición realizada');
                //        alert('xhr', xhr);
                //        alert('status', status);
                //    }                        


          });                        

        }

          /*
            testAjax(t_params, function(err, result)
            {
              //         var output = testAjax(t_params);  // output will be undefined...
              alert('output:'+t_params);
              alert('err:'+err);
              alert('result:'+result);
            });
          */

    };
 //);


    // ------------------------------------
    //        exist_invoice()
    // -----------------------------------
    function exist_invoice()
    {

         var t_params = "supplier="+$("#supplier").val()+
                        "&numdoc="+$("#numdoc").val()+
                        '&crud_type="NEW"'


          console.log('t_params:',t_params);               
          $.ajax(
          {
                url: "/api/exist_supplierinvoicenumber?"+t_params,  
                success: function(returnval) 
                {
                   //                alert("testajax - return success:");

                   //alert("testajax - Data:"+returnval["error"]+"<>"+returnval["message"]);
                   //alert("testajax - Data-message:",data["message"]);

                    if (returnval["error"] == true) 
                    {
                      var infotext = returnval["message"]+
                                      "\n   Fecha Doc : "+returnval["documentdate"]+
                                      "\n   Tipo Doc  : "+returnval["documenttype"]+
                                      "\n   Monto Neto: "+returnval["netamount"];
                        alert("ADVERTENCIA! : "+infotext)
                    }
                    else
                    {
                      //alert("testajax - validación OK:"+returnval["message"]);                       
                    }


                },
                error: function(returnval) {
                            alert("Error - se ejecuto la validación de factura repetida");
                            //$(".message").text(returnval + " failure");
                            //$(".message").fadeIn("slow");
                            //$(".message").delay(2000).fadeOut(1000);
                        }
          });                        

   };


    function extraerInput(data)
    {
      // console.log('extraerInput(data):',data);
      var s_init = data.indexOf("value=")+7;
      var s_end = data.indexOf('|');
      var long = s_end - s_init
      // console.log("data/s_init/s_end/long",data,'<>',s_init,'<>',s_end,'<>',long);
      if (long>0)
      {
          var data1 = data.substr(s_init,long);
      }
      else
      {
          var data1 = "";
      }
      // console.log("data1:",data1);

      return data1;
    }



</script>   


<!--

        si se activo la rutina por crear nueva factura

            1. se debe pasar un nuevo registro en memoria todos los campos
                pero con el detalle, se debe
                a nuevos  (N)
                    se agrega al nuevo arreglo
                b nuevos borrados (M), 
                    al  pasar por lectura se ingnora
                b para update (U)
                    se agrega al nuevo arreglo
                c para borrar (D)
                    la pasar la lectura se ignora

        si se activo la rutina por modificar la factura
            1. se debe pasar un nuevo registro en memoria todos los campos
                pero con el detalle, se debe
                a nuevos  (N)
                    se agrega al nuevo arreglo
                b nuevos borrados (M), 
                    al  pasar por lectura se ingnora
                b para update (U)
                    se agrega al nuevo arreglo
                c para borrar (D)
                    la pasar la lectura se ignora

        si se activo la rutina por eliminar la factura

            1. se debe eliminar el documento por completo

-->

<script type="text/javascript">
    function old_grabar()
    {
//        e.preventDefault();
//        alert("#grabar");

//        "form[name="myform"]").submit();



        alert("Old Grabar");


        var action = $('#titulo').text();
  //      alert(action);


        action = action.trim().substr(0,5); 
//        alert(action);

        var t_id = $('#id').text();

//        var ts = $('#tdetail').DataTable();

//        alert("t_id:",t_id);
        if (action == 'Crear')
        {
            var  detail = [];
            
//            alert('Entro por Crear');
            var ts = $('#tdetail').DataTable();
            ts.rows().every( function ( rowIdx, tableLoop, rowLoop ) 
            {

                console.log(rowIdx);
                console.log(tableLoop);
                console.log(rowLoop);

                var  Detail = new Object();

                var data = this.data();

                // var cell = this.cell({ row: rowIdx, column: 6}).cachrender();
               // console.log("cell:",cell);                
               // alert('cell:'+cell);

               // alert('cell value:'+$('input, select, textarea', cell).text());

                var tmp_string = ""
//                var data1 = data[1].value();

                alert('data.length:'+data.length);

                var i = 1; 
                while (i < 8)
                {
                   if (i >= 2 && i <= 5 || i==7)
                    {
                      data1 = extraerInput(data[i]);
                    }
                    else
                    {
                      if (i==6)
                      {
                          var s_init1 = data[i].indexOf('</opmodal')+9;
                          var s_end1 = data[i].indexOf('</select')-1;
                          var long = s_end1 - s_init1
                          // alert('Init1/End1/Long: '+s_init1+'<>'+s_end1+'<>'+long); 
                          if (long>0)
                          {
                              var data1 = data[i].substr(s_init1,long);
                              var s_init2 = data1.indexOf('<option>')+8;
                              var s_end2 = data1.indexOf('</');
                              var long = s_end2 - s_init2
                              // alert('data1/Init2/End2/Long: '+data1+s_init2+'<>'+s_end2+'<>'+long); 
                              var data1 = data1.substr(s_init2,long);                              
                          }
                          else
                          {
                              var data1 = "";
                          }

                      }

                    }
                    //    if (i in [1,2,3,4]) {
                    //    var s_init = data[i].indexOf("value=")+6;
                    //    var data1 = data[i].substr(s_init,40);

                    //    console.log("data1:",data1);

                    //    var s_end = data1.indexOf('"')-1;
                    //    data1 = data1.substr(0,s_end);
                    //}
                    //else
                    //{
                    //    var data1 = data[i];
                    //}

                    console.log("data1:",data1);

                    switch(i) 
                    {
                        case 2:
                            Detail.costcenter = data1;
                            break;
                        case 3:
                            Detail.accountcode = data1;
                            break;
                        case 4:
                            Detail.order = data1;
                            break;
                        case 5:
                            Detail.concept = data1;
                            break;
                        case 6:
                            Detail.servicemonth = data1;
                            break;
                        case 7:
                            Detail.description = data1;
                            break;
                    }

                    i++
                }
                detail.push(Detail);
                console.log(detail);
            } );                



        }
        else
        {
            alert('Entror por otra');        
        }


        $('#supplierInvoice_new').submit();

 };



    // ------------------------------------
    //         addtax()
    // -----------------------------------

    function addtax()
    {

        //  e.preventDefault();
        // alert('addTax');
        var tt = $('#ttax').DataTable();
        //  alert(ts.rows().data()[0]);

        //if (tt.rows().data()[0])
        //{
        //  alert("Solo se permite una linea")
        //}
        //else
        //{
           /*
              <a class="btn btn-default"><em class="fa fa-pencil"></em></a>
           */
            currentRow = tt.row.add( 
            [
              //'<td align="center"><a class="btn btn-danger"><em class="fa fa-trash"></em></a></td>',
              '<td align="center"><a type="delete" class="btn btn-danger"><em class="fa fa-trash"></em></a></td>',

              //'<td><input type="text" class="form-control separate-bottom" name="linenumber" id="linenumber" value="10"/></td>',
              '<td><select class="form-control selectpicker show-tick"                               name="taxcode" id="taxcode"><option selected>{{this.taxcode}}</option><option>00:Cod</option><option>X2:Perc. IIBB a n/favor CABA</option><option>X6:Perc. IIBB a n/favor CABA</option><option>X0:Perc. IIBB a n/favor CABA</option><option>XH:Perc. IIBB a n/favor Pcia. BsAs</option><option>XB:Perc. IIBB a n/favor Pcia. BsAs</option><option>X5:Perc. IIBB a n/favor Santa Fe</option><option>XG:Perc. IIBB a n/favor Tucumán</option><option>X9:Perc. IIBB a n/favor Tucumán</option><option>XE:Perc. IIBB a n/favor San Luis</option><option>XF:Perc. IIBB a n/favor Misiones</option><option>XI:Perc. IIBB a n/favor San Juan</option><option>XJ:Perc. IIBB a n/favor Salta</option><option>XK:Perc. IIBB a n/favor Catamarca</option><option>XL:Perc. IIBB a n/favor Mendoza</option></select></td>',
              '<td><input type="text" class="form-control separate-bottom" placeholder="Monto" name="taxamount" id="taxamount" value="{{this.taxamount}}"/></td>'
            ] ).draw();

            // alert(currentRow);
        //};
    };

        // ------------------------------------
        //  Ttax click
        //     - Borrar Linea
        // -----------------------------------
            $('#ttax tbody').on( 'click', 'a[type="delete"]', function () 
            {
                //alert("Click en table tax column delete");
                var table = $('#ttax').DataTable();

                table
                    .row( $(this).parents('tr') )
                    .remove()
                    .draw();                    
            } );



    $('#ttax tbody').on( 'click', 'td', function () 
    {

      // alert("Entro ");
      var currentColumn = $(this).parent().children().index($(this));
      var currentRow = $(this).parent().parent().children().index($(this).parent());
      $("#currentRow").val($(this).parent().parent().children().index($(this).parent()));
    });


        // ------------------------------------
        //        numdoc
        // -----------------------------------
        $("#numdoc").blur(function () {
        var t_params = "supplier="+$("#supplier").val()+
                        "&numdoc="+$("#numdoc").val()+
                        '&crud_type="NEW"'+
                        "&id="+$("#id").val()


          console.log('t_params:',t_params);               
          $.ajax(
          {
                url: "/api/exist_supplierinvoicenumber?"+t_params,  
                success: function(returnval) 
                {
                   //                alert("testajax - return success:");

                   //alert("testajax - Data:"+returnval["error"]+"<>"+returnval["message"]);
                   //alert("testajax - Data-message:",data["message"]);

                    if (returnval["error"] == true) 
                    {
                      var infotext = returnval["message"]+
                                      "\n   Fecha Doc : "+returnval["documentdate"]+
                                      "\n   Tipo Doc  : "+returnval["documenttype"]+
                                      "\n   Num.Doc   : "+returnval["documentnumber"]+
                                      "\n   Monto Neto: "+returnval["netamount"];
                        alert("ADVERTENCIA! : "+infotext);
                        $("#numdoc").val("");
                        //$("#numdoc").focus();
                    }
                    else
                    {
                      //alert("testajax - validación OK:"+returnval["message"]);                       
                    }


                },
                error: function(returnval) {
                            alert("Error - se ejecuto la validación de factura repetida");
                            //$(".message").text(returnval + " failure");
                            //$(".message").fadeIn("slow");
                            //$(".message").delay(2000).fadeOut(1000);
                        }
          });                        

   

        });


        // ------------------------------------
        //         exchangerate
        // -----------------------------------
        $("#currency").blur(function () 
        {
          //alert("Currency blur");

          //alert("Company");
          //alert(t_company["XA01"][0]); 
          var xcompany = $("#company :selected").text().split(":")[0];
          if (xcompany != "000")
          {

          //alert(xcompany); 
          var curr_company = t_company[xcompany][1];

          // var xcompany1 = xcompany..;
          //alert(c_currency); 

          // alert(xcompany1); 
          //alert(t_company[][0]); 


          //var currcompany = "USD";
          var valcurr = $("#currency :selected").text();
          if (curr_company == valcurr)
          {
            $("#exchangerate").val(1);
            document.getElementById("exchangerate").setAttribute("readonly", "readonly");
          }
          else
          {
            document.getElementById("exchangerate").removeAttribute("readonly");
          }
          }
          else
          {
            alert("Debe seleccionar una compañía Primero");
            $("#currency").val("000");
          }            

        });


        // ------------------------------------
        //         montoneto
        // -----------------------------------
        $("#amountinvoice").blur(function () {


            totaliza_factura();

            var num1 = transform_2_number($("#amountinvoice").val());
            var num = transform_2_formatnumber(num1);

            $("#amountinvoice").val(num);   

        });


        // ------------------------------------
        //         totaltax
        // -----------------------------------
        $("#totaltax").blur(function () {


            totaliza_factura();

            var num1 = transform_2_number($("#totaltax").val());
            var num = transform_2_formatnumber(num1);

            $("#totaltax").val(num);   

        });


        // ------------------------------------
        //         totalinvoice
        // -----------------------------------
        $("#totalinvoice").blur(function () {
            //var input = $("#totalinvoice").val();
            //input = parseFloat(num.replace(/,/g,"")).toFixed(2);
            //var num = parseFloat(input).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + " $";
            //$("#totalinvoice").val(transform_2_formatnumber(num));

            // en el replace /,/g significa reemplaza todas las ocurrencias!!
            //alert('Valor Numerico: '+parseFloat(num.replace(/,/g,"")).toFixed(2));
            //alert('Valor Numerico: '+parseFloat(num).toFixed(2));  
        });

        // -----------------------------------
        //         totaliza_factura()
        // -----------------------------------
        function totaliza_factura()
        {
            var tax = transform_2_number($("#totaltax").val());
            var neto  = transform_2_number($("#amountinvoice").val());
            //alert('tax : '+tax);
            var totalfact = neto + tax;
            //alert('tax : '+tax);
            //alert('totalfact : '+totalfact);

            $("#totalinvoice").val(transform_2_formatnumber(totalfact));
            // en el replace /,/g significa reemplaza todas las ocurrencias!!
            //var numreturn = parseFloat(valor_2_convert.replace(/,/g,"")).toFixed(2);

            //alert('Valor Numerico: '+num);
            //alert('Valor Numerico: '+parseFloat(num).toFixed(2));  
            //return numreturn;

        };



    // ------------------------------------
    //        exist_invoice()
    // -----------------------------------
    function exist_invoice()
    {

         var t_params = "supplier="+$("#supplier").val()+
                        "&numdoc="+$("#numdoc").val()+
                        '&crud_type="NEW"'


          console.log('t_params:',t_params);               
          $.ajax(
          {
                url: "/api/exist_supplierinvoicenumber?"+t_params,  
                success: function(returnval) 
                {
                   //                alert("testajax - return success:");

                   //alert("testajax - Data:"+returnval["error"]+"<>"+returnval["message"]);
                   //alert("testajax - Data-message:",data["message"]);

                    if (returnval["error"] == true) 
                    {
                      var infotext = returnval["message"]+
                                      "\n   Fecha Doc : "+returnval["documentdate"]+
                                      "\n   Tipo Doc  : "+returnval["documenttype"]+
                                      "\n   Monto Neto: "+returnval["netamount"];
                        alert("ADVERTENCIA! : "+infotext);

                    }
                    else
                    {
                      //alert("testajax - validación OK:"+returnval["message"]);                       
                    }


                },
                error: function(returnval) {
                            alert("Error - se ejecuto la validación de factura repetida");
                            //$(".message").text(returnval + " failure");
                            //$(".message").fadeIn("slow");
                            //$(".message").delay(2000).fadeOut(1000);
                        }
          });                        

   };
function validarFormulario()
{
   return true;

}

        // -------------------------------------
        //     formValidation
        // -------------------------------------        
        function formValidation()
        {  
          var supplier = document.supplierInvoice_new.supplier;
          var company  = document.supplierInvoice_new.company;
          var currency = document.supplierInvoice_new.currency;
          var amountinvoice = document.supplierInvoice_new.amountinvoice;
          var costcenter = document.supplierInvoice_new.costcenter;
          var accountcode = document.supplierInvoice_new.accountcode;
          // alert("formValidation");
          if(validation_fill(supplier))  
          {  
            if(validation_select(company))  
            {
              if(validation_select(currency))  
              {
                if(validation_fill(amountinvoice))  
                {
                  if(validation_fill(costcenter))  
                  {
                    if(validation_fill(accountcode))  
                    {
                      return true;
                    }
                  }
                }
              }
            }  
          }  
          return false;  
        } 


        function email_validation(email,mx,my)  
        {  
          var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;  
          if(email.value.match(mailformat))  
          {  
            return true;  
          }  
          else  
          {  
            alert("Email no valido");  
            email.focus();  
            return false;  
          }  
        }  

        function validation_fill(field)
        {  
          //alert("validation_fill - field:"+field.placeholder);

          var field_len = field.value.length;  
          if (field_len == 0)  
          {  
            alert("Campo no puede estar vacío, "+field.placeholder);
            field.focus();  
            return false;  
          }  
          return true;  
        }  

        function validation_select(field)
        {  

          var field_val = field.value;  
          //alert("validation_currency - value:"+field_val);

          var field_select = field_val.split(":");
          if (field_select[0] == "000")
          {  
            alert("Campo no puede estar vacío. "+field_select[1]); 
            field.focus();  
            return false;  
          }  
          return true;  
        }  


        function name_validation(name,mx,my)
        {  
          var name_len = name.value.length;  
          if (name_len == 0 || name_len >= my || name_len < mx)  
          {  
            alert("Nombre no puede estar vacío / logitud debe ser entre "+mx+" to "+my);  
            name.focus();  
            return false;  
          }  
          return true;  
        }  



 //);
</script>


