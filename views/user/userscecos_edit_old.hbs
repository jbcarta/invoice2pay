{{# each recdata }}



<!-- <p> {{ this }} </p>
-->


<input type="text" name="temporal_row" id="temporal_row"
    		hidden>

    <div class="row">
   		<h3>Datos de Usuarios</h3>

   		<form action="/profile/{{ this._id }}" method="post" id="checkout-form" class="form-horizontal">


            <!--******************************************

    							Email   

                ******************************************
            -->
    			<div class="form-group">
    				<label for="email" class="col-sm-2 control-label">Email 1:</label>
    				<div class="col-sm-4">
    					<input type="text" class="form-control" name="email" id="email"
    								value= "{{this.email}}" readonly required>
    				</div>
    			</div>


            <!--******************************************

   							Name   

                ******************************************
            -->
   				<div class="form-group">
   					<label for="name" class="col-sm-2 control-label">Nombre :</label>
   					<div class="col-sm-4">
   						<input  type="text" class="form-control" name="name"
   								value= "{{this.name}}">
    								
   					</div>
   				</div>
    				
				<hr></hr>



                <!--
                ******************************************

                            Approver Type

                ******************************************
                -->
                <div class="form-group">
                    <label for="aplevel" class="col-sm-2 control-label">Tipo de Aprobador :</label>
                    <div class="col-sm-4">

                        <select class="selectpicker form-control" name="aplevel"
                                id="aplevel" required>
                        </select>

                    </div>
                </div>

				<hr></hr>

        
                <!--
                ******************************************

                                Ceco 

                ******************************************
                -->

                <table id="tc" name="tc" 
                       class="table table-striped table-bordered" 
                       cellspacing="0" width="70%" align="left" hover>
                    <thead>
                        <tr>
                            <th>CeCo</th>
                            <th>Descripción</th>
<!--                            <th>Compañia</th>
-->
                            <th>Borrar</th>
                            <th>Mod</th>
                            <th>Estatus</th>
                        </tr>
                    </thead>

                    <tbody>
                        {{# each this.supplier }}
                            <tr>

                                <td>{{ ceco }}</td>
                                <td>{{ description }}</td>
<!--                                <td>{{ company }}</td>
                                -->
                                <td><i class="fa fa-times" aria-hidden="true"></i>
                                </td>
                                <td>
                                <i 
                                   class="fa fa-pencil-square-o"   class="editRow" 
                                   name="editRow"    id="editRow" 
                                   data-toggle="modal" 
                                   data-target=".mymodaltest">
                                </i>
                                </td>
                                <td>O</td>

                            </tr>						     
                        {{/each}}								     
                   </tbody>

<!--				                        <a name="addRowSupplier" id="addRowSupplier"><i class="fa fa-file-o"></i> Nuevo</a>
-->
				   <button name="addRowCeco"
                           id="addRowCeco" data-toggle="modal"
                           data-target=".modalAddCeco" class="btn btn-success">
				    <i class="fa fa-file-o">            		</i> Agregar CeCos</button>

				    <button name="delRowCeco"
                            id="delRowCeco" 
                            class="btn btn-danger" 
				            style="visibility: hidden">
				    <i class="fa fa-file-o"></i> Eliminar CeCos</button>

                    <button name="cancelDelRowCeco"
                            id="cancelDelRowCeco" 
				            class="btn btn-warning"
				            style="visibility: hidden">
                    <i class="fa fa-file-o"></i> Cancelar</button>


<!--
				                        <button name="saveRowSupplier" id="savstyle="visibility: hidden"eRowSupplier"  style="visibility: hidden"><i class="fa fa-floppy-o" aria-hidden="true"></i> Grabar</button>
-->				                        


			    </table>  


                <div class="form-group">

                    <input type="text" 
                           class="form-control hidden" name="save_form"
                           id="save_form" 
                           value= "NO" required>
                    <button type="submit" 
                            class="btn btn-success" onClick="save()">Grabar</button>
                    <button href="#" 
                            class="btn btn-cancel pull-left" role="button">Salir sin Grabar</a>
                </div>
    		</form>
    		
    <!--	</div>	 -->
    </div>

{{/each}}


	<!-- 
	*************************************************   
       				Nuevo Registro Modal Ceco
  *************************************************
	-->  
	<div class="modal fade modalAddCeco" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" 
      name="modalAddCeco"
			id="modalAddCeco">
  		<div class="modal-dialog" role="document">
    		<div class="modal-content">
      			<div class="modal-header">
        			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        			<h4 class="modal-title" id="gridSystemModalLabel">Nuevo Ceco</h4>
      			</div>
      			<div class="modal-body">
        			<div class="row">
          				<div class="col-md-12">

                  <!--   
                     Tabla Dinamica Cecos
                  -->       
                  <div>
                    <div class="cecos" id="cecos">
                        <table id="tcecos" name="tcecos" 
                                class="table table-striped table-bordered tcecos" cellspacing="0" width="50%">
                        </table>
                        <script src="/js/tcecos.js" type="text/javascript"> </script>
                    </div>
                  </div>

                  </div>

              </div>
      		  </div>
      			<div class="modal-footer">
        				<button type="button" class="btn btn-default" 	data-dismiss="modal">Close</button>
        				<button type="button" name="saveAddRowCeco" id="saveAddRowCeco" class="btn btn-primary" data-dismiss="modal">Incluir Proveedor</button>
      			</div>
<!--      		</div>	 -->
    		</div><!-- /.modal-content -->
  		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->


	<!-- 
	*************************************************   

       				Modificar Registro Modal

  	*************************************************
	-->  

	<div class="modal fade mymodaltest" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="mymodaltest">
  		<div class="modal-dialog" role="document">
    		<div class="modal-content">
      			<div class="modal-header">
        			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        			<h4 class="modal-title" id="gridSystemModalLabel">Asignar Proveedores</h4>
	      		</div>
  				<div class="modal-body">
    				<div class="row">
      					<div class="col-md-4">
							<div class="form-group">
								<label for="codsupplier" class="col-sm-2 control-label">Codigo Proveedor :</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" name="m_codsupplier"
											id="m_codsupplier"
											required>
								</div>
							</div>
							<div class="form-group">
								<label for="codsupplier" class="col-sm-2 control-label">Nombre    :</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" name="m_namesupplier"
											id="m_namesupplier"
											readonly required>
								</div>
							</div>

      					</div>
						</div>
  				</div>
  				<div class="modal-footer">
    				<button type="button" class="btn btn-default" 	data-dismiss="modal">Close</button>
    				<button type="button" name="saveRowSupplier" id="saveRowSupplier" class="btn btn-primary" data-dismiss="			modal">Save changes</button>
<!--  				</div> -->
	      	</div>	
    		</div><!-- /.modal-content -->
  		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->

<!-- Esta seguro si / no
-->


<!-- <script src="/js/profile.js" type="text/javascript"/> -->

<script type="text/javascript">


    // ***********************************
    //         Document Ready
    // ***********************************

    $(document).ready(function () 
    {   

        // ------------------------------------
        //         Actitate table Supply
        // -----------------------------------
        var oTable =  $('#tc').DataTable(
        {
            "pagingType": "numbers",
            "searching": false,
            "bLengthChange": false,
            dom: 'Bfrtip',
            select: true,
	          "columnDefs": 
  	        [
  	            {
                  "width": 20, 
  	              "targets": 0,
  	              "searchable": true
  	            },
  	            {
  	              "targets": 1,
   					      "width": "50%",	                
  	              "searchable": true
  	            },
  	            {
  	              "targets": [ 3 ],
  	              "visible": false
  	            }
  	        ]
    	});

    });


    // -----------------------------------
    //         #tc tbody CLICK
    // -----------------------------------
		$('#tc tbody').on( 'click', 'td', function () 
		{

			var ncolum = oTable.cell( this ).index().columnVisible;
			if (ncolum => 2 && ncolum <= 3)
			{
	  			if (oTable.cell( this ).index().columnVisible === 4)
	  			{
	  				alert('Modificar:', this);
  					var $row = $(this).closest('td');
  					alert("$row:", $row);

  					alert(oTable.row( this ).data());
  					alert(oTable.row( this ).data()[0]);
  					document.getElementById('m_codsupplier').value = oTable.row( this ).data()[0];
  					document.getElementById('m_namesupplier').value = oTable.row( this ).data()[1];
	  			}
	  			else
	  				// --------------------------------------------------
	  				//             Eliminar Ceco
	  				// --------------------------------------------------
	  				if (oTable.cell( this ).index().columnVisible === 2)
	  				{
	  					document.getElementById('temporal_row').value = this;
	  					document.getElementById('m_ceco').value = oTable.row( this ).data()[0];
  						document.getElementById('addRowCeco').style.visibility = 'hidden';
  						document.getElementById('delRowCeco').innerHTML = 'Eliminar Ceco->'+
										oTable.row( this ).data()[0];

  						document.getElementById('delRowCeco').style.visibility = 'visible';
  						document.getElementById('cancelDelRowCeco').style.visibility = 'visible';

//	  					alert('Eliminar');
	  				}

			}
		});


		// ------------------------------------
    //         saveRowCeco
    // -----------------------------------
    $('#saveRowCeco').on( 'click', function (e) 
	    {
  	    	e.preventDefault();
  	    	alert('SaveRowCeco', req.session.ncolum);

    			//		otable
    			//        	.row( this )
    			//        	.data( "Supplier5" )
    			//        	.draw();    	
      });

		// ------------------------------------
    //         cancelDelRowCeco
    // -----------------------------------
    $('#cancelDelRowCeco').on( 'click', function (e) 
    {
  	    	e.preventDefault();

    			document.getElementById('addRowCeco').style.visibility = 'visible';
    			document.getElementById('delRowCeco').style.visibility = 'hidden';
    			document.getElementById('cancelDelRowCeco').style.visibility = 'hidden';


    });

</script>




<script type="text/javascript">

// ***********************************
//         		CRUD
// ***********************************





    // ------------------------------------
    //         addRowCeco
    // -----------------------------------
    $('#addRowCeco').on( 'click', function (e) 
    {

    	e.preventDefault();

//		document.getElementById('add_m_ceco').value = "";
//		document.getElementById('add_m_description').value = "";


//    	alert("CRUD - Entre #addRowSupplier");

    } );



    // ------------------------------------
    //         findSupplierbyName
    // -----------------------------------
    $('#saveAddRowSupplier').on( 'click', function (e) 
    {
    	e.preventDefault();

    	var ts = $('#ts').DataTable();
//    	alert("Ëntre #saveAddRowSupplier" + 
//    			document.getElementById('add_m_codsupplier').value.substr(0, 2) + 
//    			document.getElementById('add_m_namesupplier').value.substr(0, 2));
//    	alert("Length :",document.getElementById('add_m_codsupplier').value.trim.length);  

    	if (document.getElementById('add_m_codsupplier').value.substr(0, 2) !== "0-" && 
	        document.getElementById('add_m_namesupplier').value.substr(0, 2) !== "0-" &&
	        document.getElementById('add_m_codsupplier').value.trim().length > 0 && 
	        document.getElementById('add_m_namesupplier').value.trim().length > 0 )
	    {

			var xcod = "/"+'({ email: "1@1.com" }, {$addToSet:{ supplier: { codsupplier: "NUEVO06", name: "NOMBRENUEVO06"} }})'+"/";

			 var xcod = document.getElementById('email').value.trim()+"&"+
			 			document.getElementById('add_m_codsupplier').value.trim()+"&"+
			 			document.getElementById('add_m_namesupplier').value.trim();
//			 var marray = xcod.split("&")
//			  alert(marray[0]);
//			  alert(marray[1]);
//			  alert(marray[2]);

//			 var email = xcods.slice(xcod,)
//			 xcod.push({"1@1.com", "NUEVO06"});
			$.getJSON("/api/restInsertUserSupplier/"+xcod, function(data)
			{

			    	console.log("dentro de update");
			    	console.log("data",data);    	
			});
    

		//({ email: "1@1.com" }, {$set:{ supplier: [{ codsupplier: "NUEVO01", name: "NOMBRENUEVO01"} ]}})	    


	        var nRow = ts.row.add( 
	        	[
		            document.getElementById('add_m_codsupplier').value.trim(),
		            document.getElementById('add_m_namesupplier').value.trim(),
		            '<td><a class="delete" href=""><i class="fa fa-times" aria-hidden="true"></i></a></td>',
		            '<td><a class="edit" href=""><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a></td>		            ',
   		            'N'
	        	] ).draw();
        }

// 		document.getElementById('addRowSupplier').style.visibility = 'hidden';
// 		document.getElementById('saveRowSupplier').style.visibility = 'visible';

    } );





    // ------------------------------------
    //         delRowSupplier
    // -----------------------------------
    $('#delRowSupplier').on( 'click', function (e) 
    {
    	e.preventDefault();

		document.getElementById('addRowSupplier').style.visibility = 'visible';
		document.getElementById('delRowSupplier').style.visibility = 'hidden';
		document.getElementById('cancelDelRowSupplier').style.visibility = 'hidden';


    	var ts = $('#ts').DataTable();

    	ts.row( document.getElementById('temporal_row')).remove();

	 	var xcod = 	document.getElementById('email').value.trim()+"&"+
	 				document.getElementById('m_codsupplier').value.trim();

		$.getJSON("/api/restDelUserSupplier/"+xcod, function(data)
		{
		   	console.log("dentro de update");
		});
    });


$('#codsupplier').blur() 
{
//	alert('codsupplier - blur');
};



$('.codsupplier').keypress(function(e) 
{
	alert('codsupplier');
    console.log(this);
    if (e.which == 13) 
    {
//        $(this).closest('tr').next().find('input.serial').focus();
          console.log("fue Enter codsupplier");

        e.preventDefault();
    }
});

    // ------------------------------------
    //         editRow
    // -----------------------------------

//	function editRow ( oTable, nRow )

//    $('#editRow').on( 'click', function (e) 


//var table = $('#ts').DataTable();
 


    // ------------------------------------
    //         saveRow
    // -----------------------------------

	function saveRow ( data )
    {

      //    	e.preventDefault();

      $('#modalAddCeco').modal('hide');

      //		alert('Save');


//      alert('data:', data);
//      var nRow = oTable.row.add( 
      var t = $('#tc').DataTable();
      t.row.add(
                 [
                    data["ceco"],
                    data["description"],
                    '<td><i class="fa fa-times" aria-hidden="true"></i></td>',
                    '<td><i class="fa fa-pencil-square-o" class="editRow" name="editRow" id="editRow"></i></td>',
                      'N'
                ] ).draw();
    } ;




    $("#aprovallevel").focus()
    {


        // ------------------------------------
        //         GetAllCecos
        // -----------------------------------
        $.getJSON("/api/restGetAprovallevels", function(data)
        {        


            var opselect = $("#aplevel1").val();
            var $select = $("#aplevel");
                       
//            console.log(data);
//            var table = $('#tcecos').DataTable();        

            $.each(data, function(index, value) 
            {
//                console.log(value);
//                table.row.add([value.ceco,  value.description]).draw();

                $select.append("<option>" + value.aplevel + "</option>");
//                alert(value.codsupplier);
            });

//            alert(" json-datasupply:", datasupply);


        });

    };

</script>



